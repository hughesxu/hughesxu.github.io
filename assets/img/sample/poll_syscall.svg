<svg width="2076" height="2093" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" overflow="hidden"><defs><clipPath id="clip0"><rect x="2697" y="2059" width="2076" height="2093"/></clipPath></defs><g clip-path="url(#clip0)" transform="translate(-2697 -2059)"><rect x="2943.5" y="2061.5" width="400" height="80" stroke="#000000" stroke-width="1.33333" stroke-miterlimit="8" fill="#FFFFFF"/><text font-family="Courier New,Courier New_MSFontService,sans-serif" font-weight="700" font-size="32" transform="translate(3008.93 2110)">poll <tspan x="95.8335" y="0">-</tspan><tspan x="134.167" y="0">syscall</tspan></text><rect x="2943.5" y="2398.5" width="400" height="81" stroke="#000000" stroke-width="1.33333" stroke-miterlimit="8" fill="#FFFFFF"/><text font-family="Courier New,Courier New_MSFontService,sans-serif" font-weight="700" font-size="32" transform="translate(3037.68 2447)">d<tspan x="19.1667" y="0">o_sys_poll</tspan></text><rect x="2830.5" y="2745.5" width="626" height="80" stroke="#000000" stroke-width="1.33333" stroke-miterlimit="8" fill="#FFFFFF"/><text font-family="Courier New,Courier New_MSFontService,sans-serif" font-weight="700" font-size="32" transform="translate(2846.02 2794)">do_poll<tspan x="134.167" y="0">(head, &amp;table, </tspan><tspan x="421.667" y="0">end_time</tspan><tspan x="575" y="0">)</tspan></text><rect x="3672.5" y="2867.5" width="400" height="80" stroke="#000000" stroke-width="1.33333" stroke-miterlimit="8" fill="#FFFFFF"/><text font-family="Courier New,Courier New_MSFontService,sans-serif" font-weight="700" font-size="32" transform="translate(3785.46 2916)">do_pollfd</text><rect x="3672.5" y="3028.5" width="400" height="99" stroke="#000000" stroke-width="1.33333" stroke-miterlimit="8" fill="#FFFFFF"/><text font-family="Courier New,Courier New_MSFontService,sans-serif" font-weight="700" font-size="32" transform="translate(3795.04 3067)">vfs_poll<tspan x="-95.8335" y="39">(file</tspan><tspan x="0" y="39">-</tspan><tspan x="19.1665" y="39">&gt;</tspan><tspan x="38.3333" y="39">f_op</tspan><tspan x="115" y="39">-</tspan><tspan x="134.167" y="39">&gt;poll)</tspan></text><rect x="3672.5" y="3208.5" width="400" height="99" stroke="#000000" stroke-width="1.33333" stroke-miterlimit="8" fill="#FFFFFF"/><text font-family="Courier New,Courier New_MSFontService,sans-serif" font-weight="700" font-size="32" transform="translate(3747.13 3247)">d<tspan x="19.1667" y="0">river module</tspan><tspan x="19.1667" y="39">(</tspan><tspan x="38.3333" y="39">poll_wait</tspan><tspan x="210.833" y="39">)</tspan></text><rect x="3630.5" y="3378.5" width="484" height="94" stroke="#000000" stroke-width="1.33333" stroke-miterlimit="8" fill="#FFFFFF"/><text font-family="Courier New,Courier New_MSFontService,sans-serif" font-weight="700" font-size="32" transform="translate(3670.46 3434)">poll_schedule_timeout</text><rect x="2943.5" y="2229.5" width="400" height="81" stroke="#000000" stroke-width="1.33333" stroke-miterlimit="8" fill="#FFFFFF"/><text font-family="Courier New,Courier New_MSFontService,sans-serif" font-weight="700" font-size="32" transform="translate(3008.93 2279)">copy_from_user</text><rect x="2887.5" y="2569.5" width="513" height="80" stroke="#000000" stroke-width="1.33333" stroke-miterlimit="8" fill="#FFFFFF"/><text font-family="Courier New,Courier New_MSFontService,sans-serif" font-weight="700" font-size="32" transform="translate(2941.85 2618)">poll_initwait<tspan x="249.167" y="0">(&amp;table)</tspan></text><rect x="2887.5" y="3754.5" width="513" height="80" stroke="#000000" stroke-width="1.33333" stroke-miterlimit="8" fill="#FFFFFF"/><text font-family="Courier New,Courier New_MSFontService,sans-serif" font-weight="700" font-size="32" transform="translate(2941.85 3803)">poll_fre<tspan x="153.333" y="0">e</tspan><tspan x="172.5" y="0">wait</tspan><tspan x="249.167" y="0">(&amp;table)</tspan></text><rect x="2698.5" y="3912.5" width="890" height="81" stroke="#000000" stroke-width="1.33333" stroke-miterlimit="8" fill="#FFFFFF"/><text font-family="Courier New,Courier New_MSFontService,sans-serif" font-weight="700" font-size="32" transform="translate(2740.6 3961)">__<tspan x="38.3335" y="0">put_user</tspan><tspan x="191.667" y="0">(</tspan><tspan x="210.833" y="0">fds</tspan>[j].<tspan x="345" y="0">revents</tspan><tspan x="479.167" y="0">, &amp;</tspan>ufds<tspan x="613.333" y="0">-</tspan><tspan x="632.5" y="0">&gt;</tspan><tspan x="651.667" y="0">revents</tspan><tspan x="785.833" y="0">)</tspan></text><path d="M3145 2141 3145 2217 3141 2217 3141 2141ZM3143 2217 3149 2209 3143 2229 3137 2209Z"/><path d="M3145 2310 3145 2386 3141 2386 3141 2310ZM3143 2386 3149 2378 3143 2398 3137 2378Z"/><path d="M3145 2479 3145 2556.73 3141 2556.73 3141 2479ZM3143 2556.73 3149 2548.73 3143 2568.73 3137 2548.73Z"/><path d="M2-4.4096e-06 2.00018 83.2347-1.99982 83.2348-2 4.4096e-06ZM0.000183516 83.2347 6.00017 75.2347 0.000209974 95.2347-5.99983 75.2348Z" transform="matrix(-1 0 0 1 3143 2649)"/><path d="M3145 2825 3145 2837 3141 2837 3141 2825ZM3145 2841 3145 2853 3141 2853 3141 2841ZM3145 2857 3145 2869 3141 2869 3141 2857ZM3145 2873 3145 2885 3141 2885 3141 2873ZM3145 2889 3145 2901 3141 2901 3141 2889ZM3145 2905 3145 2917 3141 2917 3141 2905ZM3145 2921 3145 2933 3141 2933 3141 2921ZM3145 2937 3145 2949 3141 2949 3141 2937ZM3145 2953 3145 2965 3141 2965 3141 2953ZM3145 2969 3145 2981 3141 2981 3141 2969ZM3145 2985 3145 2997 3141 2997 3141 2985ZM3145 3001 3145 3013 3141 3013 3141 3001ZM3145 3017 3145 3029 3141 3029 3141 3017ZM3145 3033 3145 3045 3141 3045 3141 3033ZM3145 3049 3145 3061 3141 3061 3141 3049ZM3145 3065 3145 3077 3141 3077 3141 3065ZM3145 3081 3145 3093 3141 3093 3141 3081ZM3145 3097 3145 3109 3141 3109 3141 3097ZM3145 3113 3145 3125 3141 3125 3141 3113ZM3145 3129 3145 3141 3141 3141 3141 3129ZM3145 3145 3145 3157 3141 3157 3141 3145ZM3145 3161 3145 3173 3141 3173 3141 3161ZM3145 3177 3145 3189 3141 3189 3141 3177ZM3145 3193 3145 3205 3141 3205 3141 3193ZM3145 3209 3145 3221 3141 3221 3141 3209ZM3145 3225 3145 3237 3141 3237 3141 3225ZM3145 3241 3145 3253 3141 3253 3141 3241ZM3145 3257 3145 3269 3141 3269 3141 3257ZM3145 3273 3145 3285 3141 3285 3141 3273ZM3145 3289 3145 3301 3141 3301 3141 3289ZM3145 3305 3145 3317 3141 3317 3141 3305ZM3145 3321 3145 3333 3141 3333 3141 3321ZM3145 3337 3145 3349 3141 3349 3141 3337ZM3145 3353 3145 3365 3141 3365 3141 3353ZM3145 3369 3145 3381 3141 3381 3141 3369ZM3145 3385 3145 3397 3141 3397 3141 3385ZM3145 3401 3145 3413 3141 3413 3141 3401ZM3145 3417 3145 3429 3141 3429 3141 3417ZM3145 3433 3145 3445 3141 3445 3141 3433ZM3145 3449 3145 3461 3141 3461 3141 3449ZM3145 3465 3145 3477 3141 3477 3141 3465ZM3145 3481 3145 3493 3141 3493 3141 3481ZM3145 3497 3145 3509 3141 3509 3141 3497ZM3145 3513 3145 3525 3141 3525 3141 3513ZM3145 3529 3145 3541 3141 3541 3141 3529ZM3145 3545 3145 3557 3141 3557 3141 3545ZM3145 3561 3145 3573 3141 3573 3141 3561ZM3145 3577 3145 3589 3141 3589 3141 3577ZM3145 3593 3145 3605 3141 3605 3141 3593ZM3145 3609 3145 3621 3141 3621 3141 3609ZM3145 3625 3145 3637 3141 3637 3141 3625ZM3145 3641 3145 3653 3141 3653 3141 3641ZM3145 3657 3145 3669 3141 3669 3141 3657ZM3145 3673 3145 3685 3141 3685 3141 3673ZM3145 3689 3145 3701 3141 3701 3141 3689ZM3145 3705 3145 3717 3141 3717 3141 3705ZM3145 3721 3145 3733 3141 3733 3141 3721ZM3145 3737 3145 3741.19 3141 3741.19 3141 3737ZM3143 3741.18 3149 3733.18 3143 3753.18 3137 3733.18Z"/><path d="M3456 2783 3873.48 2783 3873.48 2854.68 3869.48 2854.68 3869.48 2785 3871.48 2787 3456 2787ZM3871.48 2854.68 3877.48 2846.68 3871.48 2866.68 3865.48 2846.68Z"/><path d="M3874 2947 3874 3015.46 3870 3015.46 3870 2947ZM3872 3015.46 3878 3007.46 3872 3027.46 3866 3007.46Z"/><path d="M3874 3127 3874 3195.24 3870 3195.24 3870 3127ZM3872 3195.24 3878 3187.24 3872 3207.24 3866 3187.24Z"/><path d="M3874 3307 3874 3365.76 3870 3365.76 3870 3307ZM3872 3365.76 3878 3357.76 3872 3377.76 3866 3357.76Z"/><path d="M3873.61 3642 3873.61 3699.95 3143 3699.95 3145 3697.95 3145 3741.9 3141 3741.9 3141 3695.95 3871.61 3695.95 3869.61 3697.95 3869.61 3642ZM3143 3741.9 3149 3733.9 3143 3753.9 3137 3733.9Z"/><path d="M3145 3834 3145 3899.47 3141 3899.47 3141 3834ZM3143 3899.47 3149 3891.47 3143 3911.47 3137 3891.47Z"/><path d="M3041.76 4070.5 3245.24 4070.5C3271.89 4070.5 3293.5 4088.63 3293.5 4111 3293.5 4133.37 3271.89 4151.5 3245.24 4151.5L3041.76 4151.5C3015.11 4151.5 2993.5 4133.37 2993.5 4111 2993.5 4088.63 3015.11 4070.5 3041.76 4070.5Z" stroke="#000000" stroke-width="1.33333" stroke-miterlimit="8" fill="#FFFFFF" fill-rule="evenodd"/><text font-family="Courier New,Courier New_MSFontService,sans-serif" font-weight="700" font-size="32" transform="translate(3085.6 4119)">return</text><path d="M3145 3993 3145 4058.47 3141 4058.47 3141 3993ZM3143 4058.47 3149 4050.47 3143 4070.47 3137 4050.47Z"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="700" font-size="37" transform="translate(3427.03 2284)">将<tspan font-family="Courier New,Courier New_MSFontService,sans-serif" x="37.3333" y="0">pollfd</tspan>从用户空间拷贝到内核空间<tspan x="0" y="339">初始化</tspan><tspan font-family="Courier New,Courier New_MSFontService,sans-serif" x="112" y="339">poll_table</tspan><tspan font-family="Courier New,Courier New_MSFontService,sans-serif" x="335.333" y="339">, table.</tspan><tspan font-family="Courier New,Courier New_MSFontService,sans-serif" x="514" y="339">pt</tspan><tspan font-family="Courier New,Courier New_MSFontService,sans-serif" x="558.667" y="339">._</tspan><tspan font-family="Courier New,Courier New_MSFontService,sans-serif" x="603.333" y="339">qproc</tspan><tspan font-family="Courier New,Courier New_MSFontService,sans-serif" x="715" y="339">=__</tspan><tspan font-family="Courier New,Courier New_MSFontService,sans-serif" x="782" y="339">pollwait</tspan><tspan x="687.328" y="959">调用</tspan><tspan x="761.994" y="959">驱动中的</tspan><tspan font-family="Courier New,Courier New_MSFontService,sans-serif" x="911.328" y="959">poll</tspan><tspan x="1000.66" y="959">函数，将</tspan><tspan font-family="Courier New,Courier New_MSFontService,sans-serif" x="1149.99" y="959">poll</tspan><tspan x="1239.33" y="959">调</tspan><tspan x="687.328" y="1004">用进程加入到驱动定义的等待队列里</tspan><tspan x="216" y="1673">将</tspan><tspan font-family="Courier New,Courier New_MSFontService,sans-serif" x="253.333" y="1673">pollfd</tspan>再从内核空间拷贝到用户空间<tspan x="718.301" y="1145">准备让出</tspan><tspan font-family="Courier New,Courier New_MSFontService,sans-serif" x="867.634" y="1145">CPU</tspan>，进入休眠状态<tspan x="665.301" y="634">遍历每个</tspan><tspan font-family="Courier New,Courier New_MSFontService,sans-serif" x="814.635" y="634">pollfd</tspan>项，执行<tspan font-family="Courier New,Courier New_MSFontService,sans-serif" x="1097.97" y="634">do_pollfd</tspan></text><rect x="3486.5" y="3557.5" width="771" height="85" stroke="#000000" stroke-width="1.33333" stroke-miterlimit="8" fill="#FFFFFF"/><text font-family="Courier New,Courier New_MSFontService,sans-serif" font-weight="700" font-size="32" transform="translate(3536.29 3608)">pollfd<tspan x="115" y="0">-</tspan><tspan x="134.167" y="0">&gt;</tspan><tspan x="153.333" y="0">revents</tspan><tspan x="306.667" y="0">= </tspan><tspan x="345" y="0">mangle_poll</tspan><tspan x="555.833" y="0">(mask)</tspan></text><path d="M3874 3472 3874 3545.7 3870 3545.7 3870 3472ZM3872 3545.7 3878 3537.7 3872 3557.7 3866 3537.7Z"/></g></svg>